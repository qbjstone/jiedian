rule-providers:
  # 私有域名规则（局域网/本地服务，直接连接）
  private:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/private.yaml
    path: ./ruleset/private.yaml
    behavior: domain
    interval: 86400  # 每日更新1次
    format: yaml
    type: http
    timeout: 10      # 新增：规则下载超时10秒，避免卡加载（修复错误点1）

  # 中国大陆域名规则（国内网站，走本地网络）
  cn_domain:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/cn.yaml
    path: ./ruleset/cn_domain.yaml
    behavior: domain
    interval: 86400
    format: yaml
    type: http
    timeout: 10

  # 中国大陆IP规则（国内IP段，走本地网络）
  cn_ip:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geoip/cn.yaml
    path: ./ruleset/cn_ip.yaml
    behavior: ipcidr
    interval: 86400
    format: yaml
    type: http
    timeout: 10

  # 非中国大陆域名规则（境外网站，走代理）
  geolocation-!cn:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/geolocation-!cn.yaml
    path: ./ruleset/geolocation-!cn.yaml
    behavior: domain
    interval: 86400
    format: yaml
    type: http
    timeout: 10

# ========================= 代理组配置（修复：解决筛选逻辑冲突） =========================
# 关键修复：移除 url-test 类型组中的 include-all: true（与 filter 冲突导致节点不加载）
proxy-groups:
  # 1. 手动切换总入口（用户主动选择，优先级最高）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Static.png
    name: 手动切换
    type: select
    proxies:
      - 自动选择
      - 故障转移
      - 负载均衡
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 美国节点
      - 韩国节点

  # 2. 自动选择（智能选最优节点，日常默认使用）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Urltest.png
    name: 自动选择
    type: url-test
    interval: 300  # 5分钟测试1次
    timeout: 5     # 超时5秒
    retries: 2     # 重试2次
    url: https://www.gstatic.com/generate_204  # 稳定测试地址
    # 修复点2：移除 include-all: true（与 proxies 列表冲突，导致节点加载失败）
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置|失效|不可用
    proxies:  # 明确指定子节点，避免筛选冲突
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

  # 3. 区域节点组（修复：移除 include-all，仅用 filter 筛选）
  # 香港节点：匹配常见命名（如“香港CN2”“HK-BGP”）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/HK.png
    name: 香港节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    # 修复点3：仅保留 filter，删除 include-all（避免逻辑冲突）
    filter: (?i)香港|Hong Kong|HK|🇭🇰|HKG|香港CN2|香港BGP|香港PCCW

  # 台湾节点：匹配“台湾”“TW”及运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/TW.png
    name: 台湾节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)台湾|Taiwan|TW|🇹🇼|TWN|台湾中华电信|台湾远传

  # 狮城节点（新加坡）：匹配“新加坡”“SG”及运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/SG.png
    name: 狮城节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)新加坡|Singapore|SG|🇸🇬|SIN|狮城|新加坡Singtel|新加坡M1

  # 日本节点：匹配“日本”“JP”及城市/运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/JP.png
    name: 日本节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)日本|Japan|JP|🇯🇵|JPN|东京|大阪|日本SoftBank|日本KDDI

  # 美国节点：匹配“美国”“US”及城市/运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/US.png
    name: 美国节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)美国|USA|US|🇺🇸|USA|洛杉矶|纽约|美国AT&T|美国Verizon

  # 韩国节点：匹配“韩国”“KR”及城市/运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/KR.png
    name: 韩国节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)韩国|Korea|KR|🇰🇷|KOR|首尔|韩国SKTC|韩国KT

  # 4. 故障转移（节点失效自动切换，保障稳定）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Backup.png
    name: 故障转移
    type: fallback
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    proxies:  # 按物理距离排序，优先切换近程节点
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

  # 5. 负载均衡（多节点分流，降低单节点压力）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Balance.png
    name: 负载均衡
    type: load-balance
    strategy: least-delay  # 优先分配至低延迟节点
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    proxies:
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

# ========================= 规则配置（修复：统一规则格式） =========================
# 按「匹配优先级」排序，避免规则冲突
rules:
  # 1. 私有域名：直接连接（最高优先级）
  - RULE-SET,private,DIRECT
  # 2. 中国大陆域名+IP：直接连接（次高优先级）
  - RULE-SET,cn_domain,DIRECT
  - RULE-SET,cn_ip,DIRECT
  # 3. 非中国大陆域名：走自动选择（通用代理规则）
  - RULE-SET,geolocation-!cn,自动选择
  # 4. 兜底规则：未匹配请求走自动选择（修复点4：移除多余引号，统一格式）
  - MATCH,自动选择，运行后图片上的错误信息，请优化完善配置，并重新生成一份完整的配置
