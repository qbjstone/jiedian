# Clash 高性能配置文件
# 核心功能：区域节点自动选择、故障转移、负载均衡、手动切换
# 优化说明：精简无效规则、优化节点筛选逻辑、降低资源占用

# ========================= 规则提供商配置 =========================
# 仅保留核心规则集（中国大陆/非中国大陆/私有域名），减少规则加载耗时
rule-providers:
  # 私有域名规则（局域网、本地服务等，直接连接）
  private:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/private.yaml
    path: ./ruleset/private.yaml  # 本地缓存路径，避免重复下载
    behavior: domain  # 规则类型：域名匹配
    interval: 86400   # 每日更新1次，平衡时效性与资源占用
    format: yaml
    type: http

  # 中国大陆域名规则（国内网站，走本地网络）
  cn_domain:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/cn.yaml
    path: ./ruleset/cn_domain.yaml
    behavior: domain
    interval: 86400
    format: yaml
    type: http

  # 中国大陆IP规则（国内IP段，走本地网络）
  cn_ip:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geoip/cn.yaml
    path: ./ruleset/cn_ip.yaml
    behavior: ipcidr  # 规则类型：IP段匹配
    interval: 86400
    format: yaml
    type: http

  # 非中国大陆域名规则（境外网站，走代理）
  geolocation-!cn:
    url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/geolocation-!cn.yaml
    path: ./ruleset/geolocation-!cn.yaml
    behavior: domain
    interval: 86400
    format: yaml
    type: http

# ========================= 代理组配置 =========================
# 按「功能优先级」排序，核心组前置，便于工具加载与用户操作
proxy-groups:
  # 1. 手动切换总入口（用户主动选择所需功能/节点，优先级最高）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Static.png
    name: 手动切换
    type: select  # 类型：手动选择
    proxies:
      - 自动选择    # 优先推荐：智能选最优节点
      - 故障转移    # 备用：节点失效时自动切换
      - 负载均衡    # 场景化：多节点分流，适合高并发
      - 香港节点    # 区域节点：低延迟优先
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 美国节点
      - 韩国节点

  # 2. 自动选择（智能URL测试，选延迟最低节点，日常默认使用）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Urltest.png
    name: 自动选择
    type: url-test  # 类型：URL测试（测延迟选最优）
    interval: 300   # 5分钟测试1次，平衡灵敏度与资源占用
    timeout: 5      # 超时时间5秒，避免无效等待（性能优化）
    retries: 2      # 重试2次，减少测试误差（准确性优化）
    url: https://www.gstatic.com/generate_204  # 稳定测试地址（谷歌204，无内容加载快）
    include-all: true  # 包含所有可用子节点
    # 排除失效/付费节点（避免选中不可用节点，性能+体验优化）
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置|失效|不可用|付费|VIP
    proxies:  # 子节点：按物理距离排序，优先低延迟区域
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

  # 3. 区域节点组（按「物理距离+常用度」排序，便于自动选择优先级）
  # 香港节点：匹配常见命名（如“香港CN2”“HK-BGP”等，避免漏选）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/HK.png
    name: 香港节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    # 筛选关键词：覆盖“香港”“HK”及常见运营商/线路标识（节点适配核心）
    filter: (?i)香港|Hong Kong|HK|🇭🇰|HKG|香港CN2|香港BGP|香港PCCW|香港云|HK-CN2|HK-BGP

  # 台湾节点：匹配“台湾”“TW”及中华电信/远传等运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/TW.png
    name: 台湾节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)台湾|Taiwan|TW|🇹🇼|TWN|台湾中华电信|台湾远传|台湾云|TW-Hinet|TW-FarEasTone

  # 狮城节点（新加坡）：匹配“新加坡”“SG”及Singtel/M1运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/SG.png
    name: 狮城节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)新加坡|Singapore|SG|🇸🇬|SIN|狮城|新加坡Singtel|新加坡M1|SG-Singtel|SG-M1

  # 日本节点：匹配“日本”“JP”及东京/大阪城市、SoftBank运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/JP.png
    name: 日本节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)日本|Japan|JP|🇯🇵|JPN|东京|大阪|日本SoftBank|日本KDDI|JP-Tokyo|JP-Osaka

  # 美国节点：匹配“美国”“US”及洛杉矶/纽约城市、AT&T运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/US.png
    name: 美国节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)美国|USA|US|🇺🇸|USA|洛杉矶|纽约|美国AT&T|美国Verizon|US-LA|US-NY

  # 韩国节点：匹配“韩国”“KR”及首尔城市、SKTC/KT运营商
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/KR.png
    name: 韩国节点
    type: url-test
    interval: 300
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    filter: (?i)韩国|Korea|KR|🇰🇷|KOR|首尔|韩国SKTC|韩国KT|KR-Seoul|KR-SKTC

  # 4. 故障转移（节点失效时自动切换备用，保障连接稳定性）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Backup.png
    name: 故障转移
    type: fallback  # 类型：故障转移（按顺序测，第一个可用节点生效）
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    # 优先级：按物理距离排序（近→远），优先切换低延迟节点
    proxies:
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

  # 5. 负载均衡（多节点分流请求，降低单节点压力，适合高并发场景）
  - icon: https://testingcf.jsdelivr.net/gh/Orz-3/mini@master/Color/Balance.png
    name: 负载均衡
    type: load-balance  # 类型：负载均衡
    strategy: least-delay  # 策略：优先分配至延迟最低节点（性能优化）
    interval: 300  # 5分钟更新一次节点延迟，保证分配准确性
    timeout: 5
    retries: 2
    url: https://www.gstatic.com/generate_204
    include-all: true
    exclude-filter: (?i)GB|Traffic|Expire|Premium|频道|订阅|ISP|流量|到期|重置
    proxies:  # 参与分流节点：覆盖所有区域，保证分流效果
      - 香港节点
      - 台湾节点
      - 狮城节点
      - 日本节点
      - 韩国节点
      - 美国节点

# ========================= 规则配置 =========================
# 按「匹配优先级」排序（精准规则→通用规则→兜底规则），减少规则匹配耗时
rules:
  # 1. 私有域名：局域网/本地服务，直接连接（最高优先级，避免绕路）
  - "RULE-SET,private,DIRECT"
  # 2. 中国大陆域名+IP：国内网站，直接连接（次高优先级，保障国内访问速度）
  - "RULE-SET,cn_domain,DIRECT"
  - "RULE-SET,cn_ip,DIRECT"
  # 3. 非中国大陆域名：境外网站，走自动选择（通用代理规则，平衡速度与稳定性）
  - "RULE-SET,geolocation-!cn,自动选择"
  # 4. 兜底规则：未匹配任何规则的请求，走自动选择（避免漏走代理，保障兼容性）
  - "MATCH,自动选择"
